---
title: "Using Docker to stay clean. Part 02 - Visual Studio Code"
date: 2021-07-05T20:38:11+02:00
draft: true
image: logo_dockera.jpg
description: In this article, I present my way of working with Docker in a way that keeps the computer clean when using new technology for learning or occasional use. The assumptions made here are "as little Docker as possible", that is, I focus on not letting the knowledge needed to use it overshadow the knowledge we want to possess. This is the second part of the article on this topic.
categories: 
    - "Docker"
tags:
    - "docker"
    - "node.js"
series:
    - Docker for cleanliness
---
= Using Docker to stay clean. Part 02 - Visual Studio Code
Mikołaj Dalecki <mikolaj.dalecki@outlook.com>
:toc:
:source-highlighter: pygments
:icons: font
:experimental:

== Just Docker

.Plugin view
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_PLuginDocker.png[]

The Docker extension by Microsoft available at https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker allows us to easily manage and run images.
It has many more features that are beyond the scope of this article.

Its most important features are:

.A context menu view that gives access to useful functions
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_FunkcjePluginuDocker.png[]

The following functions are most interesting for _starting a new container from an image_:

Run::
    This is the equivalent of running the service from the previous part of the article. 
    It starts the given container and leaves it in the background.

Run interactive::
    Corresponds to running an interactive image. 
    After using this command, all output and the ability to interact with the image is available from the Visual Studio Code terminal.

Pull::
    Allows us to update the image if a newer version has appeared under the given tag.

Remove::
    Removes the image, freeing up disk space.

For operations on a running container, the most interesting features are:

Attach Shell::
    Connects the Visual Studio Code terminal allowing us to act in the selected container. 

Open in Browser::
    Opens the container in a browser (if the browser has provided a port for this)

Stop::
    Stops the container.

In summary - we have all the basic operations as in the console but in a much more pleasant environment.

== Remote - Containers

.View of Remote-Containers plugin
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_RemoteContainers.png[]

This is undoubtedly the best plugin to work with Docker that integrates with the plugin above, well: 

.Docker plugin extension by Remote - Containers.
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_FunkcjePluginuRemoteContainers.png[]

Attach Visual Studio Code::
    This function causes our Visual Studio Code to be reopened in the context of the container!
    This gives us the ability to open folders that are located there. 
    This gives us great integration as we can easily copy data and work on files from within Visual Studio Code. 

.View Visual Studio Code inside the container. 
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_QisokVSCWKontenerze.png[]

There is an even better part of this extension, that is::

=== .devcontainer

Visual Studio Code can run in a containerized environment (run the project in Docker) by adding a `.devcontainer` directory and in it a `devcontainer.json` file used to configure the VSC environment and a `Dockerfile` that stores information about our image in which we will be working.
VSC can complete the file structure for you through the command `((Remote-Containers)): Add Development Container Configuration Files`, so you don't have to save or remember anything.

The directory structure and file contents are as follows:

.directory structure for .devcontainer
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_WidokKonteneraDevContainer.png[]

1. a view of the directory structure,
2. The contents of the Dockerfile for the environment in which I write posts for this blog,
3. the contents of devcontainer.json, which automatically configures this environment on first startup.
4. a terminal and the ability to *open ports while running in a container*!

[sidebar]
****
You can find more about configuring Visual Studio Code under containers at https://code.visualstudio.com/docs/remote/containers-tutorial[here], and even more information at https://code.visualstudio.com/docs/remote/containers[the official Microsoft site].
****

=== Przykład z node.js 

[qanda]
Na początek utwórz katalog do pracy::
Może to być na przykład `D:/mojnodejsproject`.
Możesz to zrobić za pomocą polecenia:
+
[source,console]
----
> mkdir D:/mojnodejsproject
----

Następnie otwórz w nim Visual Studio Code::
Aby to zrobić, naciśnij prawym przyciskiem na puste miejsce w katalogu menu:PPM[Open With Code].
Możesz to również zrobić za pomocą polecenia:
+
[source,console]
----
> cd D:/mojnodejsproject
> code .
----

Utwórz przykładowy Devcontainer::
Wewnątrz Visual Studio Code naciśnij kbd:[F1] i wpisz `Remote-Container: Reopen in container` - polecenie to otworzy menu wyboru przykładowego kontenera, z którego wybierz `Node.js`, wersja dowolna (ja wybrałem 16).
Teraz trzeba chwilę poczekać na pobranie obrazu i jego uruchomienie.
W międzyczasie możesz zobaczyć, że w naszym katalogu `D:/mojnodejsproject` pojawił się katalog `
* .devcontainer` a w nim dwa pliki (o których była mowa wyżej): `devcontainer.json`, który mówi nam o konfiguracji kontenera, która zostanie przeprowadzona przez VSC.
* Dockerfile, który jest klasycznym plikiem Dockera, o którym więcej w oficjalnej dokumentacji: https://docs.docker.com/engine/reference/builder/.

W katalogu `D:/mojnodejsproject` utwórz plik `app.js`::
Możesz to również zrobić z poziomu Visual Studio Code. 
Wklej do niego kod z poprzedniej części, który umieszczam również poniżej:
+
.Kod z Getting Started z Node.js
[source,javascript]
----
const http = require('http');

const http = require('http');

const hostname = '127.0.0.1';
const port = 3000;

const server = http.createServer((req, res) => {
  res.statusCode = 200;
  res.setHeader('Content-Type', 'text/plain');
  res.end('Hello World');
});

server.listen(port, /*hostname,*/ () => {
  console.log(`Server running at http://${hostname}:${port}/`);
});
----
*Niezapomnnij zapisać treści pliku!*

Otwórz Terminal w Visual Studio Code::
Przejdź do menu:View[Terminal] na górnym pasku VSC bądź naciśnij kbd:[F1] i wpisz `Open new external terminal`.
Zobaczysz najpewniej coś podobnego:
+
[source,console]
----
node ➜ /workspaces/mojnodejsproject $ 
----
Otóż jesteśmy wewnątrz kontenera, w katalogu, który nazywa się identycznie do naszego!
Co więcej, jeśli wpiszemy polecenie `ls`, to zobaczymy, że są tam nasz plik `app.js`!
+
[source,console]
----
node ➜ /workspaces/mojnodejsproject $ ls
app.js
----

Uruchommy naszą aplikację: wpisz polecenie `node app.js` w terminalu::
Visual Studio automatycznie wykrywa, że potrzebujemy portu 3000 i sam przekieruje go do naszego komputera! Mówi nam o tym komunikat:
+
image::WykorzystanieDockeraWCeluZachowaniaCzystyosci_PrzekierowaniePortowPrzezVSC.png[]
Co więcej, możemy kliknąć przycisk btn:[Open in browser], a w naszej ulubionej przeglądarce zobaczymy wyczekiwane `Hello world`!

Baw się dalej!::
W kontenerze możesz instalować osobny zestaw dodatków, także czemu by nie dodać obsługi JavaScriptu czy samego node? 